# Лабораторна робота 1. Аналіз коду

**Проект:** Simple FastAPI Shop
**Інструменти:** Pylint, Radon, Pytest

---

### Крок 1. Огляд проекту

Взяв проект `fastapi-shop-simple`. Це "legacy" код: вся логіка в одному файлі `main.py`, архітектура відсутня, замість Pydantic-моделей використовуються звичайні словники. Типовий "спагеті-код".

---

### Крок 2-3. Проблемні місця та їх вплив

Прогнав код через аналізатори та переглянув вручну. Основні проблеми:

**1. Магічні числа (Magic Numbers)**
У методі `process_transaction` багато хардкоду:

* `if item['category'] == 1` — незрозуміло, що таке "1". Треба замінити на Enum.
* `price * 0.90` — знижка зашита в коді. Якщо бізнес захоче змінити відсоток, доведеться шукати це число по всьому проекту.
* `weekday() == 5` — неочевидно, що це субота.

**2. God Object (Великий клас)**
Клас `ShopManager` порушує принцип єдиної відповідальності (SRP). Він одночасно:

* Працює з "базою" юзерів.
* Валідує дані.
* Рахує знижки.
* Перевіряє на фрод.
* Створює замовлення.
*Наслідок:* Змінюєш логіку знижок — можеш випадково зламати реєстрацію. Тестувати такий клас дуже важко.

**3. Цикломатична складність**
У методі покупки дуже глибока вкладеність `if/else` (4-5 рівнів).
*Radon* показав індекс **C** (висока складність). Це потенційне місце для багів, бо важко прослідкувати всі шляхи виконання програми.

![alt text](image.png)

**4. Відсутність типізації (Raw Dicts)**
Ендпоінт приймає `payload: dict` замість Pydantic-схеми.
*Наслідок:* Немає автоматичної валідації полів. Якщо не передати `email`, сервер впаде з 500 помилкою (`KeyError`) замість нормальної 422 помилки для клієнта.

**5. Дублювання коду**
Валідація пароля та email знаходиться всередині функції покупки. Якщо будемо робити окрему реєстрацію, доведеться копіювати цей шматок коду (порушення DRY).

---

### Крок 4. Тести

Щоб зафіксувати поведінку коду перед можливим рефакторингом, написав 10 тестів на `pytest` (+ `TestClient`).

Покрив основні сценарії:

* Успішна покупка (різні категорії).
* Розрахунок знижок (VIP, Admin, вихідний день).
* Валідація помилок (короткий пароль, ліміт суми).
* Сайд-ефекти (створення юзера при покупці).

**Результат запуску тестів:**

![alt text](image-1.png)
---

### Висновок

Код робочий, але не придатний для масштабування. Будь-яка зміна бізнес-логіки вимагатиме значних зусиль і ризикує зламати сусідній функціонал. Потрібен рефакторинг: виділення сервісів та перехід на Pydantic.